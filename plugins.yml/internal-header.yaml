plugins:
  # Aplicar header interno a api-main (rutas protegidas)
  - name: request-transformer
    service: api-main
    route: api-main
    config:
      add:
        headers:
          - "X-Internal-Auth:${INTERNAL_SECRET}"
  # Aplicar header interno a WebSocket (necesario para validación en el servicio)
  - name: request-transformer
    service: ws
    config:
      add:
        headers:
          - "X-Internal-Auth:${INTERNAL_SECRET}"
  # Aplicar header interno a SSE (necesario para validación en el servicio)
  - name: request-transformer
    service: sse
    route: sse
    config:
      add:
        headers:
          - "X-Internal-Auth:${INTERNAL_SECRET}"
  # Aplicar header interno a SSE Metrics (sin JWT, solo header de Kong)
  # Reescribe /sse/metrics a /metrics para el backend
  - name: request-transformer
    service: sse-metrics
    route: sse-metrics
    config:
      add:
        headers:
          - "X-Internal-Auth:${INTERNAL_SECRET}"
      replace:
        uri: /metrics