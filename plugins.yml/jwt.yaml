plugins:
  # JWT para rutas protegidas de api-main (excluye /auth y /public)
  - name: jwt
    service: api-main
    route: api-main
    config:
      key_claim_name: iss
      claims_to_verify:
        - exp
      run_on_preflight: false
      header_names:
        - Authorization
      uri_param_names:
        - jwt
      cookie_names:
        - jwt
  # JWT para ruta /sse (excluye /metrics)
  # Aplicado solo a la ruta, no al servicio completo
  - name: jwt
    route: sse
    config:
      key_claim_name: iss
      claims_to_verify:
        - exp
      run_on_preflight: false
      header_names:
        - Authorization
      uri_param_names:
        - jwt
      cookie_names:
        - jwt
  # JWT para ruta /socket.io (Socket.IO)
  # Socket.IO envía el token en auth.token, pero Kong necesita leerlo del query
  # El cliente debe enviar el token como query parameter 'token' además de en auth.token
  - name: jwt
    service: ws
    route: socketio
    config:
      key_claim_name: iss
      claims_to_verify:
        - exp
      run_on_preflight: false
      header_names:
        - Authorization
      uri_param_names:
        - jwt
        - token
        - "auth[token]"
      cookie_names:
        - jwt