plugins:
  # JWT para rutas protegidas de api-main (excluye /auth y /public)
  - name: jwt
    service: api-main
    route: api-main
    config:
      key_claim_name: iss
      claims_to_verify:
        - exp
      run_on_preflight: false
      header_names:
        - Authorization
      uri_param_names:
        - jwt
      cookie_names:
        - jwt
  # JWT para ruta /sse (excluye /metrics)
  # Aplicado solo a la ruta, no al servicio completo
  - name: jwt
    route: sse
    config:
      key_claim_name: iss
      claims_to_verify:
        - exp
      run_on_preflight: false
      header_names:
        - Authorization
      uri_param_names:
        - jwt
      cookie_names:
        - jwt
  # WebSocket NO tiene JWT en Kong
  # El servicio WebSocket valida el JWT del auth.token como antes
  # Kong solo valida CORS y agrega header interno