_format_version: '3.0'
services:
- name: api-public
  url: http://api-main:3000
  routes:
  - name: api-public
    paths:
    - /api/public
    strip_path: false
- name: api-main
  url: http://api-main:3000
  routes:
  - name: api-main
    paths:
    - /api
    strip_path: true
- name: auth
  url: http://api-main:3000
  routes:
  - name: auth
    paths:
    - /api/auth
    strip_path: false
- name: sse
  url: http://sse-service:5000
  routes:
  - name: sse
    paths:
    - /sse
    strip_path: true
  - name: sse-metrics
    paths:
    - /metrics
    strip_path: true
- name: ws
  url: http://h8g4kws0880k4gowswwgwg88.138.197.203.18.sslip.io
  routes:
  - name: ws
    paths:
    - /ws
    strip_path: true
  - name: socketio
    paths:
    - /socket.io
    strip_path: true
consumers:
- username: app
  custom_id: main-app
  jwt_secrets:
  - key: dawn-backend
    secret: super-secreto-largo-y-random
plugins:
- name: cors
  service: api-main
  config:
    origins:
    - https://tuweb.com
    methods:
    - GET
    - POST
    - PUT
    - DELETE
    headers:
    - Authorization
    - Content-Type
    credentials: true
- name: request-transformer
  service: api-main
  config:
    add:
      headers:
      - 'X-Internal-Auth: rkgWV-5i9FJ3DdWli7rpYpU-sWUG_Pvc5MvZIzUFQzQ'
- name: jwt
  service: api-main
  route: api-main
  config:
    key_claim_name: iss
    claims_to_verify:
    - exp
    run_on_preflight: false
    header_names:
    - Authorization
    uri_param_names:
    - jwt
    cookie_names:
    - jwt
- name: jwt
  service: sse
  route: sse
  config:
    key_claim_name: iss
    claims_to_verify:
    - exp
    run_on_preflight: false
    header_names:
    - Authorization
    uri_param_names:
    - jwt
    cookie_names:
    - jwt
- name: jwt
  service: ws
  route: ws
  config:
    key_claim_name: iss
    claims_to_verify:
    - exp
    run_on_preflight: false
    header_names:
    - Authorization
    uri_param_names:
    - jwt
    cookie_names:
    - jwt
- name: jwt
  service: ws
  route: socketio
  config:
    key_claim_name: iss
    claims_to_verify:
    - exp
    run_on_preflight: false
    header_names:
    - Authorization
    uri_param_names:
    - jwt
    cookie_names:
    - jwt
- name: rate-limiting
  config:
    minute: 200
    policy: local
